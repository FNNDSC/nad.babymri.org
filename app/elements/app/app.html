<polymer-element name="app-element">
<template>
		<link rel="stylesheet" href="app.css"> 

		<flatiron-director route="{{route}}" autoHash>

		<core-drawer-panel id="dawerPanel">
		
			<core-header-panel drawer mode="waterfall">
	     			<core-toolbar id='drawerToolbar' class='core-header'> Navigation </core-toolbar>
				<core-menu on-core-select='{{selectActionT}}' >
					<template repeat="{{pages as page}}">
					<core-submenu id='{{page.id}}-core-submenu' icons='settings' label="{{page.label}}">
							<template repeat="{{page.subpages as subpage}}">	
								<core-item label="{{subpage.label}}" hash="#{{page.label}}/{{subpage.label}}" ><a href="#{{page.label}}/{{subpage.label}}"></core-item>
							</template>
				
						</core-submenu>
							
					</template>
	      			</core-menu>
			</core-header-panel>

	    		<core-header-panel main mode="waterfall-tall">
	      			<core-toolbar id='pageToolbar' class="core-header">
	         			<core-icon-button core-drawer-toggle icon="menu"></core-icon-button>
	        			<div id='pageTitle' class="bottom indent">MY APP</div>
	     			 </core-toolbar>
	      			<div class="content" layout horizontal center-center fit>

					<core-animated-pages  id='allPages' valueattr='hash' transitions="slide-from-right">
						<template repeat="{{page in pages}}">
							<template repeat="{{page.subpages as subpage}}">	
								<section hash="#{{page.label}}/{{subpage.label}}" layout vertical center-center>
								<div>{{subpage.label}}</div>
								<!-- prev and next buttons -->
								<a class='nav' id="{{subpage.id}}-prev" href=""><paper-button><div class='label'>prev</div></paper-button></a>
								<a class='nav' id="{{subpage.id}}-next" href=""><paper-button><div class='label'>next</div></paper-button></a>
						      		</section>
							</template>
						</template>
					</core-animated-pages>
				</div>
	      		</core-header-panel>
	      	</core-drawer-panel>
	</template>

	<script>
		Polymer('app-element', {
			// here we define the whole architecture of the website
			// this is enough to have the right 'empty pages'
		        // * COULD get that from online spreadsheet...*
			pages: [
				{id: 'home', label: 'home', color: '#2196F3', accent: '#1DE9B6', subpages: [
					{id:'home-introduction', label: 'introduction', element: 'intro-element'}
				]},
				{id: 'research', label: 'research', color: '#4CAF50', accent: '#1DE9B6', subpages: [
					{id:'research-introduction', label: 'introduction', element: 'intro-element'},
					{id:'research-mri', label: 'mri', element: 'research-element'},
					{id:'research-nirs', label: 'nirs', element: 'research-element'},
					{id:'research-meg', label: 'meg', element: 'research-element'}
				]},
				{id: 'highlights', label: 'highlights', color:'#FFC107', accent: '#1DE9B6', subpages: [
					{id:'highlights-introduction', label: 'introduction', element: 'intro-element'},
					{id:'highlights-2014', label: '2014', element: 'highlight-element'}
				]},
				{id: 'softwares', label: 'softwares', color:'#FF5722', accent: '#1DE9B6', subpages:[
					 {id:'softwares-introduction', label: 'introduction', element: 'intro-element'},	
					 {id:'softwares-chris', label: 'chris', element: 'software-element'},	
				]},
				{id: 'team', label: 'team', color: '#E91E63', accent: '#1DE9B6', subpages:[
					{id:'team-introduction', label: 'introduction', element: 'introduction-element', loaded:0},
					{id:'team-faculty', label: 'faculty', element:'team-element', loaded:0}
				]},
			],
			selectActionT: function(e, detail) {
			        //window.console.log('++++TOP++++');
			        //window.console.log(detail);
				if (detail.isSelected) {
					// get right hash!
			/*		if(typeof(detail.item.children[0].hash) !== 'undefined'){
						//var test = detail.item.children[0].hash.split('/');
						// 0, 1, 2
					}
			*/	  }
			},
			routeChanged: function(oldValue, newValue){
				window.console.log(this.route);
				var test = newValue.split('/');

				this.page = {'section': test[0],
					'subsection': test[1],
					'id': test[0] + '-' + test[1] 
				};

			},
			pageChanged: function(){

				// which section are we now?
				var prev = [0, 0];
				var cur = [0, 0];
				var next = [0, 0];

				for(var i=0; i<this.pages.length; i++){
					if(this.pages[i].id === this.page.section){
						// set color of the header
						var page = this.pages[i];
						this.$.pageToolbar.style.backgroundColor = page.color;
						for(var j=0; j<page.subpages.length; j++){
							if(page.subpages[j].label === this.page.subsection){
								// find previous
								if(j>0){
                                                                	prev = [i, j-1];
							  	}
								else{
									if(i>0){
										prev = [i-1, this.pages[i-1].subpages.length - 1];
								 	}
									else{
										prev = [0, this.pages[0].subpages.length - 1];
								 	 }
								}
								// find next
								if(j<page.subpages.length - 1){
                                                                	next = [i, j+1];
							  	}
								else{
									if(i<this.pages.length - 1){
										next = [i+1, 0];
								 	}
									else{
										// no next page
										next = [i, j];
								 	 }
								}
                                                                
								cur = [i, j];
								break;
							}
						}

						break;
					}
				}
			
				// select right page (core-selector, find with id-core-submenu)
				window.console.log(this.$[this.page.section + '-core-submenu']);
				//this.$[this.page.section + '-core-submenu'].selected = cur[0];
				//..

				// select right subpage (core-selector submenu-id)
				//..


                        	// set title
				this.$.pageTitle.innerHTML = this.page.section + ' > ' + this.page.subsection;
				// update prev and next buttons colors and content
				this.$[this.page.id + '-prev'].style.backgroundColor = this.pages[prev[0]].color;
				this.$[this.page.id + '-prev'].href = '#' + this.pages[prev[0]].id + '/' + this.pages[prev[0]].subpages[prev[1]].label;
				this.$[this.page.id + '-prev'].getElementsByClassName('label')[0].innerHTML = this.pages[prev[0]].subpages[prev[1]].label;
				
				this.$[this.page.id + '-next'].style.backgroundColor = this.pages[next[0]].color;
				this.$[this.page.id + '-next'].href = '#' + this.pages[next[0]].id + '/' + this.pages[next[0]].subpages[next[1]].label;
				this.$[this.page.id + '-next'].getElementsByClassName('label')[0].innerHTML = this.pages[next[0]].subpages[next[1]].label;
				// select right page to trigger transition
				this.$.allPages.selected = '#' + this.page.section + '/' + this.page.subsection;
			}

		});
	</script>
</polymer-element>
